<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en-US"
	prefix="og: https://ogp.me/ns#" > <![endif]--><!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en-US"
	prefix="og: https://ogp.me/ns#" > <![endif]--><!--[if IE 8]>    <html class="no-js lt-ie9" lang="en-US"
	prefix="og: https://ogp.me/ns#" > <![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en-US" prefix="og: https://ogp.me/ns#"> <!--<![endif]-->
<head>
<meta charset="UTF-8">
<link rel="profile" href="https://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php">

<meta name="viewport" content="width=device-width">

<title>High-Availability Storage With GlusterFS On CentOS – Automatic File Replication (Mirror) | vaheeD khoshnouD</title>
<meta name="description" content="This tutorial shows how to set up a high-availability storage with two storage servers (CentOS 6.3) that use GlusterFS. Each storage server will be a mirror of the other storage server, and files will be replicated automatically across both storage servers. The client system (CentOS 6.3 as well) will be able to access the storage as... Continue Reading">
<link rel="canonical" href="/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror/">
<meta property="og:site_name" content="vaheeD khoshnouD | linux, mikrotik, macosx">
<meta property="og:type" content="article">
<meta property="og:title" content="High-Availability Storage With GlusterFS On CentOS – Automatic File Replication (Mirror) | vaheeD khoshnouD">
<meta property="og:description" content="This tutorial shows how to set up a high-availability storage with two storage servers (CentOS 6.3) that use GlusterFS. Each storage server will be a mirror of the other storage server, and files will be replicated automatically across both storage servers. The client system (CentOS 6.3 as well) will be able to access the storage as... Continue Reading">
<meta property="og:url" content="http://vaheed.net/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror/">
<meta property="article:published_time" content="2013-01-16T17:10:37Z">
<meta property="article:modified_time" content="2013-01-16T17:22:25Z">
<meta property="twitter:card" content="summary">
<meta property="twitter:domain" content="vaheed.net">
<meta property="twitter:title" content="High-Availability Storage With GlusterFS On CentOS – Automatic File Replication (Mirror) | vaheeD khoshnouD">
<meta property="twitter:description" content="This tutorial shows how to set up a high-availability storage with two storage servers (CentOS 6.3) that use GlusterFS. Each storage server will be a mirror of the other storage server, and files will be replicated automatically across both storage servers. The client system (CentOS 6.3 as well) will be able to access the storage as... Continue Reading">
<script type="application/ld+json" class="aioseo-schema">
			{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebSite","@id":"http:\/\/vaheed.net\/#website","url":"http:\/\/vaheed.net\/","name":"vaheeD khoshnouD","description":"linux, mikrotik, macosx","publisher":{"@id":"http:\/\/vaheed.net\/#organization"}},{"@type":"Organization","@id":"http:\/\/vaheed.net\/#organization","name":"vaheeD khoshnouD","url":"http:\/\/vaheed.net\/"},{"@type":"BreadcrumbList","@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#breadcrumblist","itemListElement":[{"@type":"ListItem","@id":"http:\/\/vaheed.net\/#listItem","position":"1","item":{"@id":"http:\/\/vaheed.net\/#item","name":"Home","description":"vaheeD khoshnouD | linux, mikrotik, macosx","url":"http:\/\/vaheed.net\/"},"nextItem":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#listItem"},{"@type":"ListItem","@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#listItem","position":"2","item":{"@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#item","name":"High-Availability Storage With GlusterFS On CentOS - Automatic File Replication (Mirror)","description":"This tutorial shows how to set up a high-availability storage with two storage servers (CentOS 6.3) that use GlusterFS. Each storage server will be a mirror of the other storage server, and files will be replicated automatically across both storage servers. The client system (CentOS 6.3 as well) will be able to access the storage as... Continue Reading","url":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/"},"previousItem":"http:\/\/vaheed.net\/#listItem"}]},{"@type":"Person","@id":"http:\/\/vaheed.net\/author\/vaheed\/#author","url":"http:\/\/vaheed.net\/author\/vaheed\/","name":"vaheeD khoshnouD","image":{"@type":"ImageObject","@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#authorImage","url":"http:\/\/1.gravatar.com\/avatar\/4ef8c65e8d3633adf28103cadb4591c2?s=96&d=mm&r=g","width":"96","height":"96","caption":"vaheeD khoshnouD"}},{"@type":"WebPage","@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#webpage","url":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/","name":"High-Availability Storage With GlusterFS On CentOS – Automatic File Replication (Mirror) | vaheeD khoshnouD","description":"This tutorial shows how to set up a high-availability storage with two storage servers (CentOS 6.3) that use GlusterFS. Each storage server will be a mirror of the other storage server, and files will be replicated automatically across both storage servers. The client system (CentOS 6.3 as well) will be able to access the storage as... Continue Reading","inLanguage":"en-US","isPartOf":{"@id":"http:\/\/vaheed.net\/#website"},"breadcrumb":{"@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#breadcrumblist"},"author":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#author","creator":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#author","datePublished":"2013-01-16T17:10:37+03:30","dateModified":"2013-01-16T17:22:25+03:30"},{"@type":"Article","@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#article","name":"High-Availability Storage With GlusterFS On CentOS – Automatic File Replication (Mirror) | vaheeD khoshnouD","description":"This tutorial shows how to set up a high-availability storage with two storage servers (CentOS 6.3) that use GlusterFS. Each storage server will be a mirror of the other storage server, and files will be replicated automatically across both storage servers. The client system (CentOS 6.3 as well) will be able to access the storage as... Continue Reading","headline":"High-Availability Storage With GlusterFS On CentOS - Automatic File Replication (Mirror)","author":{"@id":"http:\/\/vaheed.net\/author\/vaheed\/#author"},"publisher":{"@id":"http:\/\/vaheed.net\/#organization"},"datePublished":"2013-01-16T17:10:37+03:30","dateModified":"2013-01-16T17:22:25+03:30","articleSection":"Linux","mainEntityOfPage":{"@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#webpage"},"isPartOf":{"@id":"http:\/\/vaheed.net\/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror\/#webpage"}}]}
		</script>
<script type="ee83485f985bf8feda9b8409-text/javascript">
			window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
			ga('create', "UA-3072201-3", 'auto');
			ga('send', 'pageview');
		</script>
<script async src="https://www.google-analytics.com/analytics.js" type="ee83485f985bf8feda9b8409-text/javascript"></script>

<link rel="dns-prefetch" href="//vjs.zencdn.net">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="vaheeD khoshnouD &raquo; Feed" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="vaheeD khoshnouD &raquo; Comments Feed" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="vaheeD khoshnouD &raquo; High-Availability Storage With GlusterFS On CentOS &#8211; Automatic File Replication (Mirror) Comments Feed" href="/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror/feed/">
<link rel="publisher" href="https://plus.google.com/103839803047317952696">
<script type="ee83485f985bf8feda9b8409-text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/vaheed.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}</style>
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="videojs-css" href="//vjs.zencdn.net/5.9.2/video-js.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="videojs-style-css" href="/wp-content/plugins/videojs-hls-player/videojs-hls-player.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="videojs-airplay-css" href="/wp-content/plugins/videojs-hls-player/videojs-airplay/videojs.airplay.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="wp-search-suggest-css" href="/wp-content/plugins/wp-search-suggest/css/wpss-search-suggest.css?ver=5" type="text/css" media="all">
<link rel="stylesheet" id="foundation-css" href="/wp-content/themes/drewsymo-Foundation-3b62be5/stylesheets/foundation.min.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="app-css" href="/wp-content/themes/drewsymo-Foundation-3b62be5/style.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="google-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C300&#038;ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="post-ratings-raty-css" href="/wp-content/plugins/post-ratings/assets/jquery.raty.css?ver=3.0" type="text/css" media="all">
<link rel="stylesheet" id="wp-author-bio-css" href="/wp-content/plugins/wp-about-author/wp-about-author.css?ver=5.7.2" type="text/css" media="all">
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-includes/js/jquery/jquery.min.js?ver=3.5.1" id="jquery-core-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2" id="jquery-migrate-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="//vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js?ver=1.0.2" id="videojs-ie8-js"></script>
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/posts/532">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.7.2">
<link rel="shortlink" href="/?p=532">
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Fhigh-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror%2F">
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Fhigh-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror%2F&#038;format=xml">

<!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-532 single-format-standard">
<header class="row">
<hgroup class="site-title twelve columns">
<h1><a href="/" title="vaheeD khoshnouD" rel="home">vaheeD khoshnouD</a></h1>
<h3 class="subheader">linux, mikrotik, macosx</h3>
</hgroup>
<div class="twelve columns"><ul class="nav-bar"><li class="page_item page-item-7"><a href="/about-me/">About Me</a></li></ul></div>
</header>

<script type="ee83485f985bf8feda9b8409-text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//ns1.faratar.org/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//ns1.faratar.org/piwik/piwik.php?idsite=1" style="border:0;" alt=""></p></noscript>


<div class="row">

<div class="nine columns" role="content">
<article>
<header>
<hgroup>
<h2><a href="/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror/" title="Permalink to High-Availability Storage With GlusterFS On CentOS &#8211; Automatic File Replication (Mirror)" rel="bookmark">High-Availability Storage With GlusterFS On CentOS &#8211; Automatic File Replication (Mirror)</a></h2>
<h6>Written by <a href="https://plus.google.com/103839803047317952696" title="Visit vaheeD&#8217;s website" rel="author external">vaheeD</a> on January 16, 2013</h6>
</hgroup>
</header>
<div class="post-ratings" data-post="532">
<div class="rating" data-post="532" data-rating="5" data-readonly="0"></div>
<div class="rating-meta">
<strong>5.00</strong> avg. rating (<strong>96</strong>% score) - <strong class="votes">2</strong> votes	</div>
</div>
<p><span id="more-532"></span></p>
<p>This tutorial shows how to set up a high-availability storage with two storage servers (CentOS 6.3) that use <a href="http://www.gluster.org/" target="_blank">GlusterFS</a>. Each storage server will be a mirror of the other storage server, and files will be replicated automatically across both storage servers. The client system (CentOS 6.3 as well) will be able to access the storage as if it was a local filesystem. GlusterFS is a clustered file-system capable of scaling to several peta-bytes. It aggregates various storage bricks over Infiniband RDMA or TCP/IP interconnect into one large parallel network file system. Storage bricks can be made of any commodity hardware such as x86_64 servers with SATA-II RAID and Infiniband HBA.</p>
<p>I do not issue any guarantee that this will work for you!</p>
<p>&nbsp;</p>
<h3>1 Preliminary Note</h3>
<p>In this tutorial I use three systems, two servers and a client:</p>
<ul>
<li>server1.example.com: IP address 192.168.0.100 (server)</li>
<li>server2.example.com: IP address 192.168.0.101 (server)</li>
<li>client1.example.com: IP address 192.168.0.102 (client)</li>
</ul>
<p>All three systems should be able to resolve the other systems&#8217; hostnames. If this cannot be done through DNS, you should edit the /etc/hosts file so that it looks as follows on all three systems:</p>
<pre>vi /etc/hosts
</pre>
<table width="90%" border="1" cellspacing="0" cellpadding="2" align="center" bgcolor="#CCCCCC">
<tbody>
<tr>
<td>
<pre>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
192.168.0.100   server1.example.com     server1
192.168.0.101   server2.example.com     server2
192.168.0.102   client1.example.com     client1

::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</pre>
</td>
</tr>
</tbody>
</table>
<p>(It is also possible to use IP addresses instead of hostnames in the following setup. If you prefer to use IP addresses, you don&#8217;t have to care about whether the hostnames can be resolved or not.)</p>
<p>&nbsp;</p>
<h3>2 Enable Additional Repositories</h3>
<p>server1.example.com/server2.example.com/client1.example.com:</p>
<p>First we import the GPG keys for software packages:</p>
<pre>rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY*
</pre>
<p>Then we enable the EPEL6 repository on our CentOS systems:</p>
<pre>rpm --import https://fedoraproject.org/static/0608B895.txt
</pre>
<p>&nbsp;</p>
<pre>cd /tmp
wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-7.noarch.rpm
rpm -ivh epel-release-6-7.noarch.rpm
</pre>
<p>&nbsp;</p>
<pre>yum install yum-priorities
</pre>
<p>Edit /etc/yum.repos.d/epel.repo&#8230;</p>
<pre>vi /etc/yum.repos.d/epel.repo
</pre>
<p>&#8230; and add the line priority=10 to the [epel] section:</p>
<table width="90%" border="1" cellspacing="0" cellpadding="2" align="center" bgcolor="#CCCCCC">
<tbody>
<tr>
<td>
<pre>[epel]
name=Extra Packages for Enterprise Linux 6 - $basearch
#baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch
mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch
failovermethod=priority
enabled=1
priority=10
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
[...]</pre>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h3>3 Setting Up The GlusterFS Servers</h3>
<p>server1.example.com/server2.example.com:</p>
<p>GlusterFS is available as a package for EPEL, therefore we can install it as follows:</p>
<pre>yum install glusterfs-server
</pre>
<p>Create the system startup links for the Gluster daemon and start it:</p>
<p>chkconfig &#8211;levels 235 glusterd on<br>
/etc/init.d/glusterd start</p>
<p>The command</p>
<pre>glusterfsd --version
</pre>
<p>should now show the GlusterFS version that you&#8217;ve just installed (3.2.7 in this case):</p>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5c2e3333281c2f392e2a392e6d">[email&#160;protected]</a> ~]# glusterfsd &#8211;version<br>
glusterfs 3.2.7 built on Jun 11 2012 13:22:28<br>
Repository revision: git://git.gluster.com/glusterfs.git<br>
Copyright (c) 2006-2011 Gluster Inc. &lt;http://www.gluster.com&gt;<br>
GlusterFS comes with ABSOLUTELY NO WARRANTY.<br>
You may redistribute copies of GlusterFS under the terms of the GNU General Public License.<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5e2c31312a1e2d3b2c283b2c6f">[email&#160;protected]</a> ~]#</p>
<p>If you use a firewall, ensure that TCP ports 111, 24007, 24008, 24009-(24009 + number of bricks across all volumes) are open on server1.example.com and server2.example.com.</p>
<p>Next we must add server2.example.com to the trusted storage pool (please note that I&#8217;m running all GlusterFS configuration commands from server1.example.com, but you can as well run them from server2.example.com because the configuration is repliacted between the GlusterFS nodes &#8211; just make sure you use the correct hostnames or IP addresses):</p>
<p>server1.example.com:</p>
<p>On server1.example.com, run</p>
<pre>gluster peer probe server2.example.com
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ae8f5f5eedae9ffe8ecffe8ab">[email&#160;protected]</a> ~]# gluster peer probe server2.example.com<br>
Probe successful<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="47352828330734223531223576">[email&#160;protected]</a> ~]#</p>
<p>The status of the trusted storage pool should now be similar to this:</p>
<pre>gluster peer status
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="71031e1e053102140307140340">[email&#160;protected]</a> ~]# gluster peer status<br>
Number of Peers: 1</p>
<p>Hostname: server2.example.com<br>
Uuid: 7cd93007-fccb-4fcb-8063-133e6ba81cd9<br>
State: Peer in Cluster (Connected)<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="21534e4e556152445357445310">[email&#160;protected]</a> ~]#</p>
<p>Next we create the share named testvol with two replicas (please note that the number of replicas is equal to the number of servers in this case because we want to set up mirroring) on server1.example.com and server2.example.com in the /data directory (this will be created if it doesn&#8217;t exist):</p>
<pre>gluster volume create testvol replica 2 transport tcp server1.example.com:/data server2.example.com:/data
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8efce1e1facefdebfcf8ebfcbf">[email&#160;protected]</a> ~]# gluster volume create testvol replica 2 transport tcp server1.example.com:/data server2.example.com:/data<br>
Creation of volume testvol has been successful. Please start the volume to access data.<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f5879a9a81b5869087839087c4">[email&#160;protected]</a> ~]#</p>
<p>Start the volume:</p>
<pre>gluster volume start testvol
</pre>
<p>It is possible that the above command tells you that the action was not successful:</p>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c8baa7a7bc88bbadbabeadbaf9">[email&#160;protected]</a> ~]# gluster volume start testvol<br>
Starting volume testvol has been unsuccessful<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="27554848536754425551425516">[email&#160;protected]</a> ~]#</p>
<p>In this case you should check the output of&#8230;</p>
<p>server1.example.com/server2.example.com:</p>
<pre>netstat -tap | grep glusterfsd
</pre>
<p>on both servers.</p>
<p>If you get output like this&#8230;</p>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c8baa7a7bc88bbadbabeadbaf9">[email&#160;protected]</a> ~]# netstat -tap | grep glusterfsd<br>
tcp        0      0 *:24009                     *:*                         LISTEN      1365/glusterfsd<br>
tcp        0      0 localhost:1023              localhost:24007             ESTABLISHED 1365/glusterfsd<br>
tcp        0      0 server1.example.com:24009   server1.example.com:1023    ESTABLISHED 1365/glusterfsd<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1a6875756e5a697f686c7f682b">[email&#160;protected]</a> ~]#</p>
<p>&#8230; everything is fine, but if you don&#8217;t get any output&#8230;</p>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="40322f2f340033253236253272">[email&#160;protected]</a> ~]# netstat -tap | grep glusterfsd<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="13617c7c675360766165766121">[email&#160;protected]</a> ~]#</p>
<p>&#8230; restart the GlusterFS daemon on the corresponding server (server2.example.com in this case):</p>
<p>server2.example.com:</p>
<pre>/etc/init.d/glusterfsd restart
</pre>
<p>Then check the output of&#8230;</p>
<pre>netstat -tap | grep glusterfsd
</pre>
<p>&#8230; again on that server &#8211; it should now look like this:</p>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6f1d00001b2f1c0a1d190a1d5d">[email&#160;protected]</a> ~]# netstat -tap | grep glusterfsd<br>
tcp        0      0 *:24010                 *:*                     LISTEN      1458/glusterfsd<br>
tcp        0      0 localhost.localdom:1021 localhost.localdo:24007 ESTABLISHED 1458/glusterfsd<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3a4855554e7a495f484c5f4808">[email&#160;protected]</a> ~]#</p>
<p>Now back to server1.example.com:</p>
<p>server1.example.com:</p>
<p>You can check the status of the volume with the command</p>
<pre>gluster volume info
</pre>
<div id="adrectangleb_flex" align="center"></div>
<div id="adibm300x600_flex" align="center"></div>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="33415c5c477340564145564102">[email&#160;protected]</a> ~]# gluster volume info</p>
<p>Volume Name: testvol<br>
Type: Replicate<br>
Status: Started<br>
Number of Bricks: 2<br>
Transport-type: tcp<br>
Bricks:<br>
Brick1: server1.example.com:/data<br>
Brick2: server2.example.com:/data<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c2b0adadb682b1a7b0b4a7b0f3">[email&#160;protected]</a> ~]#</p>
<p>By default, all clients can connect to the volume. If you want to grant access to client1.example.com (= 192.168.0.102) only, run:</p>
<pre>gluster volume set testvol auth.allow 192.168.0.102
</pre>
<p>Please note that it is possible to use wildcards for the IP addresses (like 192.168.*) and that you can specify multiple IP addresses separated by comma (e.g.192.168.0.102,192.168.0.103).</p>
<p>The volume info should now show the updated status:</p>
<pre>gluster volume info
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="beccd1d1cafecddbccc8dbcc8f">[email&#160;protected]</a> ~]# gluster volume info</p>
<p>Volume Name: testvol<br>
Type: Replicate<br>
Status: Started<br>
Number of Bricks: 2<br>
Transport-type: tcp<br>
Bricks:<br>
Brick1: server1.example.com:/data<br>
Brick2: server2.example.com:/data<br>
Options Reconfigured:<br>
auth.allow: 192.168.0.102<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d2a0bdbda692a1b7a0a4b7a0e3">[email&#160;protected]</a> ~]#</p>
<p>&nbsp;</p>
<h3>4 Setting Up The GlusterFS Client</h3>
<p>client1.example.com:</p>
<p>On the client, we can install the GlusterFS client as follows:</p>
<pre>yum install glusterfs-client
</pre>
<p>Then we create the following directory:</p>
<pre>mkdir /mnt/glusterfs
</pre>
<p>That&#8217;s it! Now we can mount the GlusterFS filesystem to /mnt/glusterfs with the following command:</p>
<pre>mount.glusterfs server1.example.com:/testvol /mnt/glusterfs
</pre>
<p>(Instead of server1.example.com you can as well use server2.example.com in the above command!)</p>
<p>You should now see the new share in the outputs of&#8230;</p>
<pre>mount
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3e4c51514a7e5d52575b504a0f">[email&#160;protected]</a> ~]# mount<br>
/dev/mapper/vg_client1-LogVol00 on / type ext4 (rw)<br>
proc on /proc type proc (rw)<br>
sysfs on /sys type sysfs (rw)<br>
devpts on /dev/pts type devpts (rw,gid=5,mode=620)<br>
tmpfs on /dev/shm type tmpfs (rw)<br>
/dev/sda1 on /boot type ext4 (rw)<br>
none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)<br>
sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)<br>
server1.example.com:/testvol on /mnt/glusterfs type fuse.glusterfs (rw,allow_other,default_permissions,max_read=131072)<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4c3e2323380c2f20252922387d">[email&#160;protected]</a> ~]#</p>
<p>&#8230; and&#8230;</p>
<pre>df -h
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7e0c11110a3e1d12171b100a4f">[email&#160;protected]</a> ~]# df -h<br>
Filesystem            Size  Used Avail Use% Mounted on<br>
/dev/mapper/vg_client1-LogVol00<br>
9.7G  1.7G  7.5G  19% /<br>
tmpfs                 499M     0  499M   0% /dev/shm<br>
/dev/sda1             504M   39M  440M   9% /boot<br>
server1.example.com:/testvol<br>
29G  1.1G   27G  4% /mnt/glusterfs<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a1d3ceced5e1c2cdc8c4cfd590">[email&#160;protected]</a> ~]#</p>
<p>Instead of mounting the GlusterFS share manually on the client, you could modify /etc/fstab so that the share gets mounted automatically when the client boots.</p>
<p>Open /etc/fstab and append the following line:</p>
<pre>vi /etc/fstab
</pre>
<table width="90%" border="1" cellspacing="0" cellpadding="2" align="center" bgcolor="#CCCCCC">
<tbody>
<tr>
<td>
<pre>[...]
server1.example.com:/testvol /mnt/glusterfs glusterfs defaults,_netdev 0 0</pre>
</td>
</tr>
</tbody>
</table>
<p>(Again, instead of server1.example.com you can as well use server2.example.com!)</p>
<p>To test if your modified /etc/fstab is working, reboot the client:</p>
<pre>reboot
</pre>
<p>After the reboot, you should find the share in the outputs of&#8230;</p>
<pre>df -h
</pre>
<p>&#8230; and&#8230;</p>
<pre>mount
</pre>
<p>&nbsp;</p>
<h3>5 Testing</h3>
<p>Now let&#8217;s create some test files on the GlusterFS share:</p>
<p>client1.example.com:</p>
<pre>touch /mnt/glusterfs/test1
touch /mnt/glusterfs/test2
</pre>
<p>Now let&#8217;s check the /data directory on server1.example.com and server2.example.com. The test1 and test2 files should be present on each node:</p>
<p>server1.example.com/server2.example.com:</p>
<pre>ls -l /data
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="addfc2c2d9eddec8dfdbc8df9c">[email&#160;protected]</a> ~]# ls -l /data<br>
total 8<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:17 test1<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:17 test2<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="04766b6b704477617672617635">[email&#160;protected]</a> ~]#</p>
<p>Now we shut down server1.example.com and add/delete some files on the GlusterFS share on client1.example.com.</p>
<p>server1.example.com:</p>
<pre>shutdown -h now
</pre>
<p>client1.example.com:</p>
<pre>touch /mnt/glusterfs/test3
touch /mnt/glusterfs/test4
rm -f /mnt/glusterfs/test2
</pre>
<p>The changes should be visible in the /data directory on server2.example.com:</p>
<p>server2.example.com:</p>
<pre>ls -l /data
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="11637e7e655162746367746323">[email&#160;protected]</a> ~]# ls -l /data<br>
total 8<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:17 test1<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:38 test3<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:38 test4<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8ffde0e0fbcffceafdf9eafdbd">[email&#160;protected]</a> ~]#</p>
<p>Let&#8217;s boot server1.example.com again and take a look at the /data directory:</p>
<p>server1.example.com:</p>
<pre>ls -l /data
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="13617c7c675360766165766122">[email&#160;protected]</a> ~]# ls -l /data<br>
total 8<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:17 test1<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:17 test2<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="71031e1e053102140307140340">[email&#160;protected]</a> ~]#</p>
<p>As you see, server1.example.com hasn&#8217;t noticed the changes that happened while it was down. This is easy to fix, all we need to do is invoke a read command on the GlusterFS share on client1.example.com, e.g.:</p>
<p>client1.example.com:</p>
<pre>ls -l /mnt/glusterfs/
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3c4e5353487c5f50555952480d">[email&#160;protected]</a> ~]# ls -l /mnt/glusterfs/<br>
total 8<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:17 test1<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:38 test3<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:38 test4<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6f1d00001b2f0c03060a011b5e">[email&#160;protected]</a> ~]#</p>
<p>Now take a look at the /data directory on server1.example.com again, and you should see that the changes have been replicated to that node:</p>
<p>server1.example.com:</p>
<pre>ls -l /data
</pre>
<p>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d0a2bfbfa490a3b5a2a6b5a2e1">[email&#160;protected]</a> ~]# ls -l /data<br>
total 4<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:17 test1<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:38 test3<br>
-rw-r&#8211;r&#8211; 1 root root 0 2012-12-17 11:38 test4<br>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d7a5b8b8a397a4b2a5a1b2a5e6">[email&#160;protected]</a> ~]#</p>
<p>&nbsp;</p>
<p>REFRENCE site:</p>
<p>howtoforge</p>
<div class="post-ratings" data-post="532">
<div class="rating" data-post="532" data-rating="5" data-readonly="0"></div>
<div class="rating-meta">
<strong>5.00</strong> avg. rating (<strong>96</strong>% score) - <strong class="votes">2</strong> votes	</div>
</div>
<footer>
<p></p>
<p>Posted Under: <a href="/category/linux/" rel="category tag">Linux</a></p>
<section class="row">
<div class="twelve columns">
<div class="panel author-box">
<a class="th"><img alt="" src="https://1.gravatar.com/avatar/4ef8c65e8d3633adf28103cadb4591c2?s=55&#038;d=mm&#038;r=g" srcset="http://1.gravatar.com/avatar/4ef8c65e8d3633adf28103cadb4591c2?s=110&#038;d=mm&#038;r=g 2x" class="author_gravatar left  avatar-55 photo" height="55" width="55" loading="lazy"></a>
<h5>About <a href="https://plus.google.com/103839803047317952696" title="Visit vaheeD&#8217;s website" rel="author external">vaheeD</a>
</h5>
<p>
</p>
</div>
</div>
</section>


<div id="respond" class="comment-respond">
<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/high-availability-storage-with-glusterfs-on-centos-automatic-file-replication-mirror/#respond" style="display:none;">Cancel reply</a></small>
</h3>
<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p>
<p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p>
<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required="required"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" required="required"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200"></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes"> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="532" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p>
<div style="text-align:center; font-style:italic; font-size:12px;">Protected by <a href="http://boliquan.com/wp-anti-spam/" target="_blank">WP Anti Spam</a>
</div>
</form> </div>
</footer>
</article>
<hr>
</div>


<aside class="three columns">
<div>
<form method="get" id="searchform" action="/">
<div class="row">
<div class="twelve columns">
<div class="row collapse">
<div class="eight mobile-three columns">
<input type="text" name="s" id="s" placeholder="Search">
</div>
<div class="four mobile-one columns">
<input type="submit" class="postfix button expand" name="submit" id="searchsubmit" value="Search">
</div>
</div>
</div>
</div>
</form>
</div>
<div>
<h5>Categories</h5>
<ul>
<li class="cat-item cat-item-17">
<a href="/category/cisco/">Cisco</a>
</li>
<li class="cat-item cat-item-6">
<a href="/category/linux/">Linux</a>
</li>
<li class="cat-item cat-item-8">
<a href="/category/macosx/">Macosx</a>
</li>
<li class="cat-item cat-item-7">
<a href="/category/mikrotik/">MikroTik</a>
</li>
<li class="cat-item cat-item-10">
<a href="/category/network/">Network</a>
</li>
<li class="cat-item cat-item-20">
<a href="/category/openstack/">openstack</a>
</li>
<li class="cat-item cat-item-11">
<a href="/category/security/">Security</a>
</li>
<li class="cat-item cat-item-1">
<a href="/category/uncategorized/">Uncategorized</a>
</li>
</ul>
</div>
</aside>

</div>


<footer class="row">
<div class="twelve columns">
<ul class="link-list">
</ul>
</div>
</footer>

<div id="foot">
<strong>vaheeD.NET</strong> | linux, mikrotik, macosx | 2012, 2013</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="ee83485f985bf8feda9b8409-text/javascript" src="//vjs.zencdn.net/5.9.2/video.js?ver=1.0.2" id="videojs-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-content/plugins/videojs-hls-player/videojs-contrib-hls/videojs-contrib-hls.min.js?ver=1.0.2" id="videojs-hls-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-content/plugins/videojs-hls-player/videojs-airplay/videojs.airplay.js?ver=1.0.2" id="videojs-airplay-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-content/plugins/videojs-hls-player/videojs-hls-player.js?ver=1.0.2" id="videojs-custom-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-includes/js/jquery/suggest.min.js?ver=1.1-20110113" id="suggest-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" id="wp-search-suggest-js-extra">
/* <![CDATA[ */
var wpss_options = {"url":"http:\/\/vaheed.net\/wp-admin\/admin-ajax.php","nonce":"ffc31e8139","ajaxurl":"http:\/\/vaheed.net\/wp-admin\/admin-ajax.php?action=wp-search-suggest&_wpnonce=9c0d5b0c5c"};
/* ]]> */
</script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-content/plugins/wp-search-suggest/js/wpss-search-suggest.js?ver=5" id="wp-search-suggest-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-content/themes/drewsymo-Foundation-3b62be5/javascripts/foundation.min.js?ver=1.0" id="foundation-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-content/themes/drewsymo-Foundation-3b62be5/javascripts/app.js?ver=1.0" id="app-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" id="post-ratings-js-extra">
/* <![CDATA[ */
var post_ratings = {"ajaxURL":"http:\/\/vaheed.net\/wp-admin\/admin-ajax.php","nonce":"a8b298b24a","path":"http:\/\/vaheed.net\/wp-content\/plugins\/post-ratings\/assets\/images\/","number":"5"};
/* ]]> */
</script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-content/plugins/post-ratings/js/post-ratings.js?ver=3.0" id="post-ratings-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-content/plugins/post-ratings/assets/jquery.raty.js?ver=3.0" id="post-ratings-raty-js"></script>
<script type="ee83485f985bf8feda9b8409-text/javascript" src="/wp-includes/js/wp-embed.min.js?ver=5.7.2" id="wp-embed-js"></script>
<script src="https://ajax.cloudflare.com/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="ee83485f985bf8feda9b8409-|49" defer></script>
</body>
</html>